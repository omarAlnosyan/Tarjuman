<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ±Ø¬Ù…Ø§Ù† - Architecture Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #795548;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #a1887f;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid #d7ccc8;
            padding-bottom: 10px;
        }
        .diagram {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .mermaid {
            text-align: center;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-right: 4px solid #2196f3;
        }
        .download-btn {
            display: inline-block;
            background: #795548;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 5px;
        }
        .download-btn:hover {
            background: #5d4037;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ï¸ ØªØ±Ø¬Ù…Ø§Ù† - Architecture Diagrams</h1>
        
        <div class="info">
            <strong>ğŸ’¡ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong><br>
            â€¢ Ø§Ù„Ø±Ø³ÙˆÙ… Ø£Ø¯Ù†Ø§Ù‡ ØªÙØ§Ø¹Ù„ÙŠØ© - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„ØªØµØºÙŠØ±<br>
            â€¢ Ù„ØªØ­Ù…ÙŠÙ„ ÙƒØµÙˆØ±Ø©: Ø§Ø¶ØºØ· Ø¨Ø²Ø± Ø§Ù„Ù…Ø§ÙˆØ³ Ø§Ù„Ø£ÙŠÙ…Ù† â†’ "Save Image"<br>
            â€¢ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Mermaid Live Editor: <a href="https://mermaid.live/" target="_blank">mermaid.live</a>
        </div>

        <h2>1ï¸âƒ£ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„ (Complete Architecture)</h2>
        <div class="diagram">
            <div class="mermaid">
graph TB
    subgraph "User Interface Layer"
        UI[Next.js Frontend<br/>Port 3000<br/>tarjuman-ui/]
        UI --> |HTTP POST| API
    end
    
    subgraph "API Gateway Layer"
        API[FastAPI Backend<br/>Port 8000<br/>api/main.py]
        API --> |Validate| GUARD[Guardrails Check]
        GUARD --> |Valid| SEARCH
        GUARD --> |Invalid| ERROR[400 Error]
    end
    
    subgraph "Search Engine Layer"
        SEARCH[Hybrid Search Engine]
        SEARCH --> EXACT[Exact Match<br/>SparseRetriever]
        SEARCH --> BM25[BM25 Search<br/>Keyword-based<br/>Weight: 70%]
        SEARCH --> FAISS[FAISS Search<br/>Semantic<br/>Weight: 30%]
        EXACT --> MERGE[Merge & Rank<br/>RRF Algorithm]
        BM25 --> MERGE
        FAISS --> MERGE
        MERGE --> RESULT[SearchResult]
    end
    
    subgraph "LLM Layer"
        RESULT --> LLM[LLM Enhancement<br/>Llama 3.3 70B<br/>Groq API]
        LLM --> |Enhanced| RESPONSE[API Response]
        RESULT --> |Fallback| RESPONSE
    end
    
    subgraph "Data Layer"
        JSON[(all_chunks_final.json<br/>687 verses<br/>JSON Format)]
        VDB[(ChromaDB<br/>Vector Database<br/>FAISS Index)]
        DOCX[(Raw DOCX File<br/>Source Data)]
        
        EXACT --> JSON
        BM25 --> JSON
        FAISS --> VDB
        DOCX --> |Process| JSON
        JSON --> |Build| VDB
    end
    
    RESPONSE --> |JSON| UI
    
    style UI fill:#e1f5ff
    style API fill:#fff4e1
    style SEARCH fill:#f3e5f5
    style LLM fill:#e8f5e9
    style JSON fill:#ffebee
    style VDB fill:#ffebee
    style DOCX fill:#ffebee
            </div>
        </div>

        <h2>2ï¸âƒ£ ØªØ¯ÙÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Data Flow)</h2>
        <div class="diagram">
            <div class="mermaid">
flowchart TD
    START([User Types Verse<br/>Ø¹ÙØª Ø§Ù„Ø¯ÙŠØ§Ø± Ù…Ø­Ù„Ù‡Ø§ ÙÙ…Ù‚Ø§Ù…Ù‡Ø§]) --> FRONT[Frontend<br/>Next.js]
    
    FRONT --> |POST /search| API[FastAPI Backend]
    
    API --> GUARD{Guardrails Check}
    GUARD -->|Invalid| REJECT[400 Error<br/>Not Poetry Query]
    GUARD -->|Valid| HYBRID[Hybrid Search]
    
    HYBRID --> EXACT{Exact Match?}
    EXACT -->|Found| RESULT1[Result: Score 1.0]
    EXACT -->|Not Found| BM25_SEARCH[BM25 Search]
    
    BM25_SEARCH --> BM25_RESULT[Top 5 Results<br/>Score: 0.85]
    BM25_SEARCH --> FAISS_SEARCH[FAISS Search]
    
    FAISS_SEARCH --> FAISS_RESULT[Top 5 Results<br/>Score: 0.78]
    
    BM25_RESULT --> MERGE[Merge & Rank<br/>0.7 Ã— BM25 + 0.3 Ã— FAISS]
    FAISS_RESULT --> MERGE
    RESULT1 --> MERGE
    
    MERGE --> FINAL[Final Result<br/>Score: 0.829]
    
    FINAL --> LLM_CHECK{LLM Available?}
    LLM_CHECK -->|Yes| LLM[Enhance Explanation<br/>Llama 3.3 70B]
    LLM_CHECK -->|No| ORIGINAL[Original Explanation]
    
    LLM --> ENHANCED[Enhanced Explanation]
    ORIGINAL --> ENHANCED
    
    ENHANCED --> RESPONSE[API Response<br/>JSON]
    RESPONSE --> DISPLAY[Display Result<br/>Verse Card]
    DISPLAY --> END([User Sees Result])
    
    style START fill:#e3f2fd
    style FRONT fill:#e1f5ff
    style API fill:#fff4e1
    style HYBRID fill:#f3e5f5
    style LLM fill:#e8f5e9
    style DISPLAY fill:#e1f5ff
    style END fill:#e3f2fd
    style REJECT fill:#ffebee
            </div>
        </div>

        <h2>3ï¸âƒ£ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Components)</h2>
        <div class="diagram">
            <div class="mermaid">
graph LR
    subgraph "Frontend Components"
        A[Homepage<br/>Welcome + Examples]
        B[Search Input<br/>Verse Query]
        C[Result Card<br/>Verse Display]
        D[Sidebar<br/>Examples List]
        A --> B
        B --> C
        D --> B
    end
    
    subgraph "Backend Components"
        E[API Endpoints<br/>/search, /health, /poets]
        F[Guardrails<br/>is_poetry_query]
        G[Hybrid Retriever<br/>BM25 + FAISS]
        H[LLM Service<br/>Groq API]
        E --> F
        F --> G
        G --> H
    end
    
    subgraph "Data Components"
        I[JSON Database<br/>687 verses]
        J[ChromaDB<br/>Vector Store]
        K[BM25 Index<br/>In-memory]
        L[DOCX Source<br/>Raw Data]
        L --> I
        I --> J
        I --> K
    end
    
    A --> E
    C --> E
    G --> I
    G --> J
    G --> K
    H --> I
    
    style A fill:#e1f5ff
    style B fill:#e1f5ff
    style C fill:#e1f5ff
    style D fill:#e1f5ff
    style E fill:#fff4e1
    style F fill:#fff4e1
    style G fill:#f3e5f5
    style H fill:#e8f5e9
    style I fill:#ffebee
    style J fill:#ffebee
    style K fill:#ffebee
    style L fill:#ffebee
            </div>
        </div>

        <div class="info">
            <strong>ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©:</strong><br>
            <a href="ARCHITECTURE_DIAGRAM.mmd" class="download-btn" download>ØªØ­Ù…ÙŠÙ„ ARCHITECTURE_DIAGRAM.mmd</a>
            <a href="ARCHITECTURE_FLOW.mmd" class="download-btn" download>ØªØ­Ù…ÙŠÙ„ ARCHITECTURE_FLOW.mmd</a>
            <a href="ARCHITECTURE_COMPONENTS.mmd" class="download-btn" download>ØªØ­Ù…ÙŠÙ„ ARCHITECTURE_COMPONENTS.mmd</a>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>
